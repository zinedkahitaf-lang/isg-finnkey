<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>İSG Chat + Fotoğraftan FINN KEY</title>
<style>
/* (senin CSS aynen) */
</style>
</head>
<body>
<!-- (senin HTML aynen) -->

<script>
const BASE=""; // ✅ Render'da aynı domain

const chatEl=document.getElementById("chat");
const history=[{role:"assistant",content:"Merhaba. İSG ile ilgili durumu kısaca anlatır mısın?"}];

function render(){
  chatEl.innerHTML="";
  history.forEach(m=>{
    const d=document.createElement("div");
    d.className="msg "+(m.role==="user"?"user":"assistant");
    const b=document.createElement("div");
    b.className="bubble";
    b.textContent=m.content;
    d.appendChild(b);
    chatEl.appendChild(d);
  });
  chatEl.scrollTop=chatEl.scrollHeight;
}
render();

async function sendChat(){
  const chatInput=document.getElementById("chatInput");
  const t=chatInput.value.trim();
  if(!t) return;
  history.push({role:"user",content:t});
  chatInput.value="";
  render();

  const r=await fetch(BASE+"/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({messages:history})
  });

  const d=await r.json();
  history.push({role:"assistant",content:d.reply||"Hata"});
  render();
}

async function runFinnKey(){
  const photo=document.getElementById("photo");
  const note=document.getElementById("note");
  const out=document.getElementById("out");

  const f=photo.files[0];
  if(!f){out.textContent="Fotoğraf seç.";return;}
  out.textContent="Analiz ediliyor…";

  const fd=new FormData();
  fd.append("file",f);
  fd.append("note",note.value||"");

  const r=await fetch(BASE+"/photo-finnkey",{method:"POST",body:fd});
  const d=await r.json();
  out.textContent=d.result||"Hata";
}

document.getElementById("sendBtn").onclick=sendChat;
document.getElementById("finnBtn").onclick=runFinnKey;
document.getElementById("copyBtn").onclick=()=>navigator.clipboard.writeText(document.getElementById("out").textContent||"");
</script>
</body>
</html>
